<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 文档 - Koa 项目</title>

    <!-- Bootstrap CSS -->
    <link href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://unpkg.com/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Swagger UI CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.18.2/swagger-ui.css" />

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .header-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .main-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            overflow: hidden;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .content-area {
            height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .swagger-ui .topbar {
            display: none;
        }

        .swagger-ui .opblock {
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .swagger-ui .opblock .opblock-summary {
            padding: 15px;
        }

        @media (max-width: 768px) {
            .sidebar {
                height: auto;
                max-height: 300px;
            }

            .content-area {
                height: auto;
                min-height: 500px;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>

<body>
    <div class="header-container">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <div class="col-md-6">
                    <h1 class="h3 mb-0 text-primary">
                        <i class="bi bi-code-slash me-2"></i>API 文档中心
                    </h1>
                    <p class="text-muted mb-0 small">Koa 项目 RESTful API 接口文档</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="expand-all-btn">
                            <i class="bi bi-arrows-expand me-1"></i>展开全部
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="collapse-all-btn">
                            <i class="bi bi-arrows-collapse me-1"></i>收起全部
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="main-container">
            <div class="row g-0">
                <div class="col-md-3 sidebar">
                    <div class="p-3">
                        <h5 class="text-primary mb-3">
                            <i class="bi bi-list-ul me-2"></i>接口分类
                        </h5>
                        <div id="api-tags" class="list-group list-group-flush text-center"></div>
                    </div>
                </div>
                <div class="col-md-9 content-area">
                    <div id="swagger-ui"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://unpkg.com/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Swagger UI JS -->
    <script src="https://unpkg.com/swagger-ui-dist@5.18.2/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.18.2/swagger-ui-standalone-preset.js"></script>

    <script>
        window.onload = function() {
            SwaggerUIBundle({
                url: '/swagger.json',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
                plugins: [SwaggerUIBundle.plugins.DownloadUrl],
                layout: "StandaloneLayout",
                onComplete: function() {
                    generateTagList();
                    addCustomStyles();
                    setupEventListeners();
                }
            });
        };

        function generateTagList() {
    const tagList = document.getElementById('api-tags');
    if (!tagList) return;

    const interval = setInterval(() => {
        const allTagSections = Array.from(document.querySelectorAll('.opblock-tag-section'));
        if (!allTagSections.length) return;

        clearInterval(interval);

        allTagSections.forEach(section => {
            const tagEl = section.querySelector('.opblock-tag');
            if (!tagEl) return;

            // 取 <span> 的文字
            const tagName = tagEl.querySelector('span')?.textContent.trim() || '未命名分类';
            const opblocks = Array.from(section.querySelectorAll('.opblock'));

            const tagItem = document.createElement('a');
            tagItem.href = `#${encodeURIComponent(tagName)}`;
            tagItem.className = 'list-group-item list-group-item-action d-flex flex-column align-items-center justify-content-center';
            tagItem.style.cursor = 'pointer';

            tagItem.innerHTML = `
    <div class="d-flex w-100 justify-content-between align-items-center">
        <strong class="text-dark">${tagName}</strong>
        <span class="badge bg-primary rounded-pill">${opblocks.length}</span>
    </div>
`;


            tagItem.addEventListener('click', e => {
                e.preventDefault();
                tagEl.scrollIntoView({ behavior: 'smooth' });
            });

            tagList.appendChild(tagItem);
        });
    }, 100);
}



        function addCustomStyles() {
            document.querySelectorAll('.opblock').forEach(block => {
                block.style.transition = 'all 0.3s ease';
                block.addEventListener('mouseenter', () => {
                    block.style.transform = 'translateY(-2px)';
                    block.style.boxShadow = '0 4px 16px rgba(0,0,0,0.15)';
                });
                block.addEventListener('mouseleave', () => {
                    block.style.transform = 'translateY(0)';
                    block.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                });
            });
        }

        function expandAll() {
            document.querySelectorAll('.opblock-summary').forEach(btn => {
                const op = btn.closest('.opblock');
                if (op.classList.contains('is-collapsed')) btn.click();
            });
        }

        function collapseAll() {
            document.querySelectorAll('.opblock-summary').forEach(btn => {
                const op = btn.closest('.opblock');
                if (!op.classList.contains('is-collapsed')) btn.click();
            });
        }

        function setupEventListeners() {
            document.getElementById('expand-all-btn') ?.addEventListener('click', expandAll);
            document.getElementById('collapse-all-btn') ?.addEventListener('click', collapseAll);
        }
    </script>
</body>

</html>